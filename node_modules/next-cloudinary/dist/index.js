"use strict";var Ee=Object.create;var z=Object.defineProperty;var xe=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var Te=(e,r)=>{for(var n in r)z(e,n,{get:r[n],enumerable:!0})},ie=(e,r,n,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of _e(r))!ve.call(e,t)&&t!==n&&z(e,t,{get:()=>r[t],enumerable:!(o=xe(r,t))||o.enumerable});return e};var O=(e,r,n)=>(n=e!=null?Ee(be(e)):{},ie(r||!e||!e.__esModule?z(n,"default",{value:e,enumerable:!0}):n,e)),Le=e=>ie(z({},"__esModule",{value:!0}),e);var Ve={};Te(Ve,{CldImage:()=>Q,CldOgImage:()=>ee,CldUploadButton:()=>te,CldUploadWidget:()=>B,CldVideoPlayer:()=>oe,cloudinaryLoader:()=>Y,getCldImageUrl:()=>w,getCldOgImageUrl:()=>Pe});module.exports=Le(Ve);var v=O(require("react")),ge=O(require("next/image")),ue=require("@cloudinary-util/util"),me=require("@cloudinary-util/url-loader");async function X(e){let{src:r}=e;try{await new Promise((n,o)=>{fetch(r).then(t=>{if(!t.ok){o(t);return}n(t)})})}catch(n){return n.status===423?await X(e):!1}return!0}var pe=require("@cloudinary-util/url-loader");var de=O(require("next/package.json"));var ae={name:"next-cloudinary",version:"4.27.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.11.0","@cloudinary-util/util":"^2.2.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2",mkdirp:"^3.0.1","ts-jest":"^29.0.3",tsup:"^7.2.0",typescript:"^5.2.2"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var le="V",se=ae.version,ce=de.default.version;function w(e,r,n){var t,d;let o=(d=(t=r==null?void 0:r.cloud)==null?void 0:t.cloudName)!=null?d:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;return(0,pe.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:o}},r),analytics:Object.assign({sdkCode:le,sdkSemver:se,techVersion:ce,feature:""},n)})}function Y({loaderOptions:e,imageProps:r,cldOptions:n,cldConfig:o={}}){let t={...r,...n};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let d=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*d))}else typeof(e==null?void 0:e.width)=="number"&&typeof(t==null?void 0:t.width)!="number"&&(t.width=e.width,t.widthResize=e.width);return w(t,o)}var fe=(0,v.forwardRef)((e,r)=>{let n=!1,o=["deliveryType","preserveTransformations"];me.transformationPlugins.forEach(({props:a=[]})=>{a.forEach(s=>{if(o.includes(s))throw new Error(`Option ${s} already exists!`);o.push(s)})});let t={alt:e.alt,src:e.src};Object.keys(e).filter(a=>!o.includes(a)).forEach(a=>t[a]=e[a]);let d=Object.keys(t).map(a=>`${a}:${t[a]}`).join(";"),[u,h]=(0,v.useState)(d),c={};if(o.forEach(a=>{e[a]&&(c[a]=e[a]||void 0)}),e.preserveTransformations)try{let a=(0,ue.getTransformations)(e.src).map(s=>s.join(","));c.rawTransformations=[...a.flat(),...e.rawTransformations||[]]}catch(a){console.warn(`Failed to preserve transformations: ${a.message}`)}let m=process.env.__NEXT_IMAGE_OPTS||{};(e.unoptimized===!0||(m==null?void 0:m.unoptimized)===!0)&&(t.src=w({...c,width:t.width,height:t.height,src:t.src,format:"default",quality:"default"},e.config));async function i(a){let s=!0;if(n)return;if(n=!0,typeof e.onError=="function"){let E=e.onError(a);typeof E=="boolean"&&E===!1&&(s=!1)}else typeof e.onError=="boolean"&&e.onError===!1&&(s=!1);if(s===!1)return;let L=a.target;await X({src:L.src})&&h(`${d};${Date.now()}`)}let T=(0,v.useCallback)(i,[X,d]),C=ge.default;return"default"in C&&(C=C.default),v.default.createElement(C,{key:u,...t,loader:a=>Y({loaderOptions:a,imageProps:t,cldOptions:c,cldConfig:e.config}),onError:T,ref:r})});fe.displayName="CldImage";var Q=fe;var P=O(require("react")),ye=O(require("next/head"));var Me="summary_large_image",Ae=({excludeTags:e=[],twitterTitle:r,keys:n={},...o})=>{let{alt:t}=o,d={...o,crop:o.crop||"fill",gravity:o.gravity||"center",height:o.height||1254,src:o.src,width:o.width||2400,widthResize:o.width||1200},u=typeof d.width=="string"?parseInt(d.width):d.width,h=typeof d.height=="string"?parseInt(d.height):d.height;typeof h=="number"&&typeof u=="number"&&(h=1200/u*h),u=1200;let c=w({...d,format:o.format||"jpg"}),m=w({...d,format:o.format||"webp"}),i={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n};return P.default.createElement(ye.default,null,P.default.createElement("meta",{key:i["og:image"],property:"og:image",content:c}),P.default.createElement("meta",{key:i["og:image:secure_url"],property:"og:image:secure_url",content:c}),P.default.createElement("meta",{key:i["og:image:width"],property:"og:image:width",content:`${u}`}),P.default.createElement("meta",{key:i["og:image:height"],property:"og:image:height",content:`${h}`}),t&&P.default.createElement("meta",{key:i["og:image:alt"],property:"og:image:alt",content:t}),!e.includes("twitter:title")&&P.default.createElement("meta",{key:i["twitter:title"],property:"twitter:title",content:r||" "}),P.default.createElement("meta",{key:i["twitter:card"],property:"twitter:card",content:Me}),P.default.createElement("meta",{key:i["twitter:image"],property:"twitter:image",content:m}))},ee=Ae;var F=O(require("react"));var y=O(require("react")),he=O(require("next/script"));function Ce(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ne=["success","display-changed"],De={abort:"onAbort","batch-cancelled":"onBatchCancelled","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"},Se=({children:e,onClose:r,onError:n,onOpen:o,onUpload:t,options:d,signatureEndpoint:u,uploadPreset:h,...c})=>{let m=(0,y.useRef)(),i=(0,y.useRef)(),T=!!u,[C,a]=(0,y.useState)(void 0),[s,L]=(0,y.useState)(void 0),[M,E]=(0,y.useState)(!0),x={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:h||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...d};T&&(x.uploadSignature=A,x.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,y.useEffect)(()=>{if(typeof s=="undefined")return;let p=s.event==="success",I=s.event==="display-changed"&&s.info==="hidden";p&&typeof t=="function"&&t(s,i.current),I&&typeof r=="function"&&r(i.current)},[s]),(0,y.useEffect)(()=>{C&&typeof n=="function"&&n(C,i.current)},[C]);function W(){E(!1),m.current||(m.current=window.cloudinary),Ce(()=>{i.current||(i.current=k())})}function A(p,I){if(typeof u=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(u,{method:"POST",body:JSON.stringify({paramsToSign:I})}).then(g=>g.json()).then(({signature:g})=>{p(g)})}function f(p,I=[]){if(i.current||(i.current=k()),typeof(i==null?void 0:i.current[p])=="function")return i.current[p](...I)}function V(p){f("close",[p])}function N(p){return f("destroy",[p])}function _(){f("hide")}function D(){return f("isDestroyed")}function S(){return f("isMinimized")}function j(){return f("isShowing")}function q(){f("minimize")}function R(p,I){f("open",[p,I]),typeof o=="function"&&o(i.current)}function G(){f("show")}function H(){f("update")}let K={close:V,destroy:N,hide:_,isDestroyed:D,isMinimized:S,isShowing:j,minimize:q,open:R,show:G,update:H};function k(){var p;return(p=m.current)==null?void 0:p.createUploadWidget(x,(I,g)=>{if(typeof I=="string"&&a(I),typeof(g==null?void 0:g.event)=="string"){Ne.includes(g==null?void 0:g.event)&&L(g);let l=De[g.event];if(typeof l=="string"&&typeof c[l]=="function"&&typeof c[l]){let b=c[l];b(g,{widget:i.current,...K})}}})}return y.default.createElement(y.default.Fragment,null,typeof e=="function"&&e({cloudinary:m.current,widget:i.current,results:s,error:C,isLoading:M,...K}),y.default.createElement(he.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:W,onError:p=>console.error(`Failed to load Cloudinary Upload Widget: ${p.message}`)}))},B=Se;var Ge=({className:e,children:r,onClick:n,onError:o,onOpen:t,onUpload:d,onAbort:u,onBatchCancelled:h,onClose:c,onDisplayChanged:m,onPublicId:i,onQueuesEnd:T,onQueuesStart:C,onRetry:a,onShowCompleted:s,onSourceChanged:L,onSuccess:M,onTags:E,onUploadAdded:x,options:W,signatureEndpoint:A,uploadPreset:f,...V})=>F.default.createElement(F.default.Fragment,null,F.default.createElement(B,{onError:o,onOpen:t,onUpload:d,onAbort:u,onBatchCancelled:h,onClose:c,onDisplayChanged:m,onPublicId:i,onQueuesEnd:T,onQueuesStart:C,onRetry:a,onShowCompleted:s,onSourceChanged:L,onSuccess:M,onTags:E,onUploadAdded:x,options:W,signatureEndpoint:A,uploadPreset:f},({open:N,isLoading:_})=>{function D(S){S.preventDefault(),N(),typeof n=="function"&&n(S)}return F.default.createElement("button",{...V,className:e||"",onClick:D,disabled:_},r||"Upload")})),te=Ge;var U=O(require("react")),Ue=O(require("next/script")),Oe=O(require("next/head")),we=require("@cloudinary-util/util"),Ie=[],ke=e=>{let{autoPlay:r="never",className:n,colors:o,controls:t=!0,fontFace:d,height:u,id:h,logo:c=!0,loop:m=!1,muted:i=!1,onDataLoad:T,onError:C,onMetadataLoad:a,onPause:s,onPlay:L,onEnded:M,src:E,sourceTypes:x,transformation:W,version:A="1.9.16",quality:f="auto",width:V}=e,N=Array.isArray(W)?W:[W],_=E||"";if(typeof e.version=="string"&&console.warn("The version prop will no longer be supported in future versions due to the unreliability of coordinating assets"),_.startsWith("http"))try{let l=(0,we.parseUrl)(E);typeof(l==null?void 0:l.publicId)=="string"&&(_=l==null?void 0:l.publicId)}catch(l){}N.unshift({quality:f});let D=(0,U.useRef)(),S=(0,U.useRef)(),j=e.videoRef||S,q=(0,U.useRef)(),R=e.playerRef||q,G=h||`player-${_.replace("/","-")}`,H="cld-video-player cld-fluid";n&&(H=`${H} ${n}`),Ie.filter(l=>l===G).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work. 
    Try adding a unique id to each player.`):Ie.push(G);let k={error:C,loadeddata:T,loadedmetadata:a,pause:s,play:L,ended:M};function p(l){let b=k[l.type];typeof b=="function"&&b(g())}function I(){if("cloudinary"in window){D.current=window.cloudinary;let l={};typeof c=="boolean"?l.showLogo=c:typeof c=="object"&&(l={...l,showLogo:!0,logoImageUrl:c.imageUrl,logoOnclickUrl:c.onClickUrl});let b={autoplayMode:r,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:t,fontFace:d||"",loop:m,muted:i,publicId:_,secure:!0,transformation:N,...l};Array.isArray(x)&&(b.sourceTypes=x),typeof o=="object"&&(b.colors=o),R.current=D.current.videoPlayer(j.current,b),Object.keys(k).forEach(re=>{var ne;typeof k[re]=="function"&&((ne=R.current)==null||ne.on(re,p))})}}function g(){return{player:R.current,video:j.current}}return U.default.createElement(U.default.Fragment,null,U.default.createElement(Oe.default,null,U.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${A}/dist/cld-video-player.min.css`,rel:"stylesheet"})),U.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},U.default.createElement("video",{ref:j,id:G,className:H,width:V,height:u}),U.default.createElement(Ue.default,{id:`cloudinary-videoplayer-${G}`,src:`https://unpkg.com/cloudinary-video-player@${A}/dist/cld-video-player.min.js`,onLoad:I,onError:l=>console.error(`Failed to load Cloudinary Video Player: ${l.message}`)})))},oe=ke;function Pe(e){return w({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl});
//# sourceMappingURL=index.js.map